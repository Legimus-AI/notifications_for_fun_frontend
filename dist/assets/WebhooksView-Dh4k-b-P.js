import{d as Y,u as Z,s as ee,g as f,h as F,o as se,c as i,a as e,b,t as d,i as v,j as te,e as c,w as V,r as ae,F as W,k as A,T as oe,C as ie,l as le,f as l,n as m,m as ne,p as de,_ as re}from"./index-BhisPscf.js";import{v as ce,e as U,z as ue}from"./bootstrap-vue-3.es-BeRwdurs.js";const ve={class:"webhooks-container"},be={class:"page-header"},me={class:"page-header__content"},he={class:"header-stats"},ge={class:"stat-card"},pe={class:"stat-content"},ke={class:"stat-value"},_e={class:"stat-card"},fe={class:"stat-content"},we={class:"stat-value"},ye={class:"content-wrapper"},Ce={key:0,class:"state-container"},We={key:1,class:"state-container"},Ae={class:"state-card error"},xe={class:"state-text"},Fe={key:2,class:"state-container"},Ve={class:"state-card empty"},Te={key:3,class:"channels-grid"},Ne={class:"card-header"},Me={class:"channel-info"},Se={class:"channel-title"},De={class:"channel-name"},Ue={class:"channel-meta"},Ee={key:0,class:"meta-item"},Ie={class:"meta-item"},Pe={class:"channel-actions"},$e=["onClick"],Le={class:"webhook-form"},ze=["onSubmit"],Re={class:"form-group"},Be={class:"input-group"},je={class:"form-group"},qe={class:"events-grid"},Ge={class:"event-content"},He={class:"event-label"},Je={class:"form-actions"},Ke=["onClick"],Oe=["disabled"],Qe={key:0,class:"btn-spinner"},Xe={key:1,class:"bi bi-plus-circle me-2"},Ye={class:"webhooks-section"},Ze={class:"section-header"},es={class:"webhook-count"},ss={key:0,class:"empty-webhooks"},ts={key:1,class:"webhooks-list"},as={class:"webhook-status"},os={class:"webhook-content"},is={class:"webhook-url"},ls={class:"url-text"},ns={class:"webhook-events"},ds={class:"webhook-controls"},rs={class:"toggle-wrapper"},cs=["onClick"],us=Y({__name:"WebhooksView",setup(vs){const h=Z(),{success:x,error:g}=le(),{channels:E,isLoading:w,error:T}=ee(h),p=f({}),r=f({}),y=f(!1),k=f({title:"",message:"",variant:"danger",confirmText:"Delete"}),_=f(null),I=[{value:"message.received",label:"Message Received"},{value:"message.sent",label:"Message Sent"},{value:"message.delivered",label:"Message Delivered"},{value:"message.read",label:"Message Read"}],C=F(()=>E.value.filter(t=>t.status==="active"||t.status==="open")),P=F(()=>C.value.length),$=F(()=>C.value.reduce((t,s)=>{var u;return t+(((u=s.webhooks)==null?void 0:u.length)||0)},0)),N=async()=>{try{await h.fetchChannels()}catch{g("Failed to load channels. Please try again.")}},L=t=>{p.value[t]=!0,r.value[t]||(r.value[t]={url:"",events:["message.received"]})},z=(t,s)=>{r.value[t]||(r.value[t]={url:"",events:["message.received"]}),r.value[t].url=s},R=(t,s)=>{r.value[t]||(r.value[t]={url:"",events:["message.received"]}),r.value[t].events=s},M=t=>{p.value[t]=!1,r.value[t]={url:"",events:["message.received"]}},B=async t=>{const s=r.value[t];if(!s||!s.url||s.events.length===0){g("Please fill in all required fields and select at least one event.");return}try{await h.addWebhookToChannel(t,{url:s.url,events:s.events}),x("Webhook added successfully!"),M(t)}catch(u){console.error("Failed to add webhook:",u),g("Failed to add webhook. Please try again.")}},j=async(t,s,u)=>{if(s)try{await h.toggleChannelWebhook(t,s,u),x(`Webhook ${u?"activated":"deactivated"} successfully!`)}catch(a){console.error("Failed to toggle webhook:",a),g("Failed to update webhook status. Please try again.")}},q=(t,s)=>{s&&(k.value={title:"Delete Webhook",message:"Are you sure you want to delete this webhook? This action cannot be undone.",variant:"danger",confirmText:"Delete Webhook"},_.value=async()=>{await G(t,s)},y.value=!0)},G=async(t,s)=>{try{await h.deleteChannelWebhook(t,s),x("Webhook deleted successfully!")}catch(u){console.error("Failed to delete webhook:",u),g("Failed to delete webhook. Please try again.")}},H=async()=>{if(_.value)try{await _.value()}catch(t){console.error("Action failed:",t)}y.value=!1,_.value=null},J=()=>{y.value=!1,_.value=null},K=t=>{switch(t){case"active":case"open":return"success";case"connecting":return"warning";case"error":return"danger";default:return"secondary"}},O=t=>{switch(t){case"active":case"open":return"Active";case"connecting":return"Connecting";case"error":return"Error";default:return"Inactive"}},S=t=>{switch(t){case"message.received":return"bi bi-arrow-down-circle";case"message.sent":return"bi bi-arrow-up-circle";case"message.delivered":return"bi bi-check-circle";case"message.read":return"bi bi-check2-all";default:return"bi bi-circle"}},Q=t=>t.split(".").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ");return se(N),(t,s)=>{const u=ae("router-link");return l(),i("div",ve,[e("header",be,[e("div",me,[s[4]||(s[4]=e("div",{class:"page-title-section"},[e("h1",{class:"page-title"},"Webhook Management"),e("p",{class:"page-subtitle"}," Configure and monitor webhook endpoints for real-time notifications ")],-1)),e("div",he,[e("div",ge,[s[1]||(s[1]=e("div",{class:"stat-icon"},[e("i",{class:"bi bi-broadcast"})],-1)),e("div",pe,[e("div",ke,d(P.value),1),s[0]||(s[0]=e("div",{class:"stat-label"},"Active Channels",-1))])]),e("div",_e,[s[3]||(s[3]=e("div",{class:"stat-icon"},[e("i",{class:"bi bi-link-45deg"})],-1)),e("div",fe,[e("div",we,d($.value),1),s[2]||(s[2]=e("div",{class:"stat-label"},"Total Webhooks",-1))])])])])]),e("div",ye,[v(w)?(l(),i("div",Ce,s[5]||(s[5]=[te('<div class="state-card loading" data-v-62d6d1e4><div class="state-icon" data-v-62d6d1e4><div class="loading-spinner" data-v-62d6d1e4><div class="spinner" data-v-62d6d1e4></div></div></div><h3 class="state-title" data-v-62d6d1e4>Loading Channels</h3><p class="state-text" data-v-62d6d1e4>Please wait while we fetch your channels...</p></div>',1)]))):v(T)?(l(),i("div",We,[e("div",Ae,[s[7]||(s[7]=e("div",{class:"state-icon"},[e("i",{class:"bi bi-exclamation-triangle"})],-1)),s[8]||(s[8]=e("h3",{class:"state-title"},"Something went wrong",-1)),e("p",xe,d(v(T)),1),e("button",{class:"modern-btn primary",onClick:N},s[6]||(s[6]=[e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),c("Try Again ")]))])])):C.value.length===0?(l(),i("div",Fe,[e("div",Ve,[s[10]||(s[10]=e("div",{class:"state-icon"},[e("i",{class:"bi bi-chat-dots"})],-1)),s[11]||(s[11]=e("h3",{class:"state-title"},"No Active Channels",-1)),s[12]||(s[12]=e("p",{class:"state-text"}," Create and activate WhatsApp channels to start configuring webhooks ",-1)),b(u,{to:"/",class:"modern-btn success"},{default:V(()=>s[9]||(s[9]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),c("Create First Channel ")])),_:1,__:[9]})])])):(l(),i("div",Te,[(l(!0),i(W,null,A(C.value,a=>(l(),i("div",{key:a.channelId,class:"modern-card channel-card"},[e("div",Ne,[s[17]||(s[17]=e("div",{class:"channel-avatar"},[e("i",{class:"bi bi-whatsapp"})],-1)),e("div",Me,[e("div",Se,[e("h3",De,d(a.name),1),e("span",{class:m(["status-badge",K(a.status)])},[s[13]||(s[13]=e("i",{class:"status-dot"},null,-1)),c(" "+d(O(a.status)),1)],2)]),e("div",Ue,[a.phoneNumber?(l(),i("span",Ee,[s[14]||(s[14]=e("i",{class:"bi bi-telephone me-1"},null,-1)),c(d(a.phoneNumber),1)])):ne("",!0),e("span",Ie,[s[15]||(s[15]=e("i",{class:"bi bi-tag me-1"},null,-1)),c(d(a.channelId.slice(0,8))+"... ",1)])])]),e("div",Pe,[e("button",{class:m(["modern-btn primary sm",{active:p.value[a.channelId]}]),onClick:o=>L(a.channelId)},s[16]||(s[16]=[e("i",{class:"bi bi-plus-lg"},null,-1),e("span",null,"Add Webhook",-1)]),10,$e)])]),b(v(ue),{modelValue:p.value[a.channelId],"onUpdate:modelValue":o=>p.value[a.channelId]=o,class:"webhook-form-collapse"},{default:V(()=>{var o;return[e("div",Le,[s[23]||(s[23]=e("div",{class:"form-header"},[e("h4",{class:"form-title"},[e("i",{class:"bi bi-plus-circle me-2"}),c(" Configure New Webhook ")]),e("p",{class:"form-subtitle"}," Add a webhook endpoint to receive real-time notifications ")],-1)),e("form",{onSubmit:de(n=>B(a.channelId),["prevent"]),class:"modern-form"},[e("div",Re,[s[19]||(s[19]=e("label",{class:"form-label"},[e("i",{class:"bi bi-link me-2"}),c("Webhook URL ")],-1)),e("div",Be,[s[18]||(s[18]=e("div",{class:"input-icon"},[e("i",{class:"bi bi-globe"})],-1)),b(v(ce),{"model-value":((o=r.value[a.channelId])==null?void 0:o.url)||"","onUpdate:modelValue":n=>z(a.channelId,n),type:"url",placeholder:"https://your-server.com/webhook",required:"",class:"modern-input"},null,8,["model-value","onUpdate:modelValue"])])]),e("div",je,[s[20]||(s[20]=e("label",{class:"form-label"},[e("i",{class:"bi bi-lightning me-2"}),c("Event Types ")],-1)),e("div",qe,[(l(),i(W,null,A(I,n=>{var D;return e("div",{key:n.value,class:"event-option"},[b(v(U),{"model-value":((D=r.value[a.channelId])==null?void 0:D.events)||[],"onUpdate:modelValue":X=>R(a.channelId,X),value:n.value,class:"event-checkbox"},{default:V(()=>[e("div",Ge,[e("i",{class:m(["event-icon",S(n.value)])},null,2),e("span",He,d(n.label),1)])]),_:2},1032,["model-value","onUpdate:modelValue","value"])])}),64))])]),e("div",Je,[e("button",{type:"button",class:"modern-btn secondary",onClick:n=>M(a.channelId)},s[21]||(s[21]=[e("i",{class:"bi bi-x me-2"},null,-1),c("Cancel ")]),8,Ke),e("button",{type:"submit",class:"modern-btn primary",disabled:v(w)},[v(w)?(l(),i("span",Qe,s[22]||(s[22]=[e("i",{class:"bi bi-arrow-repeat spinning me-2"},null,-1)]))):(l(),i("i",Xe)),c(" "+d(v(w)?"Adding...":"Add Webhook"),1)],8,Oe)])],40,ze)])]}),_:2},1032,["modelValue","onUpdate:modelValue"]),e("div",Ye,[e("div",Ze,[s[24]||(s[24]=e("h4",{class:"section-title"},[e("i",{class:"bi bi-list-check me-2"}),c(" Configured Webhooks ")],-1)),e("div",es,d((a.webhooks||[]).length),1)]),!a.webhooks||a.webhooks.length===0?(l(),i("div",ss,s[25]||(s[25]=[e("div",{class:"empty-icon"},[e("i",{class:"bi bi-link-45deg"})],-1),e("p",{class:"empty-text"},"No webhooks configured yet",-1)]))):(l(),i("div",ts,[(l(!0),i(W,null,A(a.webhooks,o=>(l(),i("div",{key:o._id,class:m(["webhook-item",{inactive:!o.isActive}])},[e("div",as,[e("div",{class:m(["status-indicator",{active:o.isActive}])},null,2)]),e("div",os,[e("div",is,[s[26]||(s[26]=e("i",{class:"bi bi-link-45deg me-2"},null,-1)),e("span",ls,d(o.url),1),e("div",{class:m(["webhook-badge",{active:o.isActive}])},d(o.isActive?"Active":"Inactive"),3)]),e("div",ns,[(l(!0),i(W,null,A(o.events,n=>(l(),i("span",{key:n,class:"event-badge"},[e("i",{class:m(["event-badge-icon",S(n)])},null,2),c(" "+d(Q(n)),1)]))),128))])]),e("div",ds,[e("div",rs,[b(v(U),{switch:"",checked:o.isActive,onChange:n=>o._id&&j(a.channelId,o._id,!o.isActive),class:"modern-toggle"},null,8,["checked","onChange"])]),e("button",{class:"action-btn danger",onClick:n=>o._id&&q(a.channelId,o._id),title:"Delete Webhook"},s[27]||(s[27]=[e("i",{class:"bi bi-trash3"},null,-1)]),8,cs)])],2))),128))]))])]))),128))]))]),b(oe),b(ie,{show:y.value,title:k.value.title,message:k.value.message,variant:k.value.variant,"confirm-text":k.value.confirmText,onConfirm:H,onCancel:J},null,8,["show","title","message","variant","confirm-text"])])}}}),hs=re(us,[["__scopeId","data-v-62d6d1e4"]]);export{hs as default};
