import{q,g as A,h as W,v as U,d as L,u as z,s as B,o as G,c as r,a as e,b as d,e as f,r as K,i as v,m as S,p as M,x as R,y as Q,F as H,k as T,z as X,t as _,l as Y,f as c,A as Z,n as V,_ as ee}from"./index-C8KqdBWK.js";const se=q("contacts",()=>{const m=A([]),u=A(!1),y=A(null),p=A([]),x=W(()=>h=>m.value.find(n=>n.jid===h)),I=W(()=>p.value.slice(-10).reverse()),P=h=>`${h.replace(/\D/g,"")}@s.whatsapp.net`;return{contacts:m,loading:u,error:y,searchHistory:p,getContactByJid:x,recentSearches:I,phoneToJid:P,jidToPhone:h=>h.split("@")[0],checkContact:async(h,n)=>{var g,C;u.value=!0,y.value=null;try{const a=P(n),i=await U.checkContact(h,a);if(i.ok&&i.payload){const k=m.value.findIndex(O=>O.jid===a),N={jid:a,phoneNumber:n,exists:i.payload.exists,name:i.payload.name,isWhatsAppUser:i.payload.isWhatsAppUser};return k>=0?m.value[k]={...m.value[k],...N}:m.value.push(N),p.value.includes(n)||p.value.push(n),i.payload}throw new Error(i.message||"Failed to check contact")}catch(a){throw y.value=((C=(g=a.response)==null?void 0:g.data)==null?void 0:C.message)||a.message||"Failed to check contact",a}finally{u.value=!1}},getContactStatus:async(h,n)=>{var g,C;u.value=!0,y.value=null;try{const a=await U.getContactStatus(h,n);if(a.ok&&a.payload){const i=m.value.findIndex(k=>k.jid===n);return i>=0&&(m.value[i]={...m.value[i],status:a.payload.status,lastSeen:a.payload.lastSeen,isOnline:a.payload.isOnline}),a.payload}throw new Error(a.message||"Failed to get contact status")}catch(a){throw y.value=((C=(g=a.response)==null?void 0:g.data)==null?void 0:C.message)||a.message||"Failed to get contact status",a}finally{u.value=!1}},getContactProfilePicture:async(h,n)=>{var g,C;u.value=!0,y.value=null;try{const a=await U.getContactProfilePicture(h,n);if(a.ok&&a.payload){const i=m.value.findIndex(k=>k.jid===n);return i>=0&&(m.value[i]={...m.value[i],profilePicture:a.payload.url}),a.payload}throw new Error(a.message||"Failed to get profile picture")}catch(a){throw y.value=((C=(g=a.response)==null?void 0:g.data)==null?void 0:C.message)||a.message||"Failed to get profile picture",a}finally{u.value=!1}},clearContacts:()=>{m.value=[],y.value=null},clearSearchHistory:()=>{p.value=[]},removeFromSearchHistory:h=>{const n=p.value.indexOf(h);n>-1&&p.value.splice(n,1)}}}),te={class:"contacts-view"},ae={class:"header-section"},oe={class:"container-fluid"},ne={class:"row align-items-center"},le={class:"col"},ce={class:"page-title"},ie={class:"col-auto"},re=["disabled"],de={class:"main-content"},ue={class:"container-fluid"},he={class:"modern-card search-section"},me={class:"card-body"},pe={class:"row"},ve={class:"col-lg-6"},fe={class:"card-title mb-4"},_e={class:"mb-3"},ye=["value"],be={class:"mb-3"},ge={class:"input-group"},Ce=["disabled"],ke={key:0,class:"col-lg-6"},we={class:"card-title mb-4"},Se={class:"recent-searches"},xe=["onClick"],Pe={class:"phone-number"},Fe=["onClick"],Ie={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},Ae={key:1,class:"contacts-section"},De={class:"section-title mb-4"},Ne={class:"row"},je={class:"modern-card contact-card"},Ee={class:"card-body"},Oe={class:"contact-avatar-section"},Ue={class:"contact-avatar"},He=["src","alt"],Te=["onClick","disabled"],Ve={class:"contact-info"},We={class:"contact-name"},$e={class:"contact-phone"},Je={class:"status-badges mb-3"},Be={key:0,class:"contact-status mb-2"},Me={class:"text-muted"},Re={key:1,class:"contact-last-seen mb-3"},qe={class:"text-muted"},Le={class:"contact-actions"},ze=["onClick","disabled"],Ge=["onClick"],Ke={key:2,class:"empty-state"},Qe={class:"text-center"},Xe=L({__name:"ContactsView",setup(m){const u=se(),y=z(),{success:p,error:x,warning:I}=Y(),{contacts:P,loading:F,error:D,recentSearches:E}=B(u),{channels:$}=B(y),b=A(""),w=A(""),J=W(()=>$.value.filter(o=>o.status==="connected"||o.status==="authenticated")),h=async()=>{try{await y.fetchChannels()}catch(o){x(o.message||"Failed to load channels")}},n=async()=>{if(!b.value||!w.value){I("Please select a channel and enter a phone number");return}try{const o=await u.checkContact(b.value,w.value);o.exists?p(`Contact found: ${o.name||w.value}`):I("Contact not found")}catch(o){x(o.message||"Failed to search contact")}},g=async o=>{if(!b.value){I("Please select a channel");return}try{await u.getContactStatus(b.value,o.jid),p("Status updated")}catch(s){x(s.message||"Failed to load status")}},C=async o=>{if(!b.value){I("Please select a channel");return}try{await u.getContactProfilePicture(b.value,o.jid),p("Profile picture loaded")}catch(s){x(s.message||"Failed to load profile picture")}},a=async o=>{try{await navigator.clipboard.writeText(o),p("JID copied to clipboard")}catch{x("Failed to copy JID")}},i=o=>{const s=o.target;s.style.display="none"},k=o=>{try{return new Date(o).toLocaleString()}catch{return o}},N=()=>{u.clearContacts(),u.clearSearchHistory(),p("All data cleared")},O=o=>{u.removeFromSearchHistory(o),p("Removed from history")};return G(h),(o,s)=>{const l=K("font-awesome-icon");return c(),r("div",te,[e("div",ae,[e("div",oe,[e("div",ne,[e("div",le,[e("h1",ce,[d(l,{icon:["fas","address-book"],class:"me-3"}),s[3]||(s[3]=f(" Contact Management "))]),s[4]||(s[4]=e("p",{class:"page-subtitle"}," Search and manage WhatsApp contacts across your channels ",-1))]),e("div",ie,[e("button",{onClick:N,class:"modern-btn btn-outline-danger",disabled:!v(P).length},[d(l,{icon:["fas","trash"],class:"me-2"}),s[5]||(s[5]=f(" Clear All Data "))],8,re)])])])]),e("div",de,[e("div",ue,[e("div",he,[e("div",me,[e("div",pe,[e("div",ve,[e("h5",fe,[d(l,{icon:["fas","search"],class:"me-2"}),s[6]||(s[6]=f(" Search Contact "))]),e("form",{onSubmit:M(n,["prevent"]),class:"search-form"},[e("div",_e,[s[8]||(s[8]=e("label",{for:"channelSelect",class:"form-label"},"Select Channel",-1)),R(e("select",{id:"channelSelect","onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),class:"form-select",required:""},[s[7]||(s[7]=e("option",{value:""},"Choose a channel...",-1)),(c(!0),r(H,null,T(J.value,t=>(c(),r("option",{key:t.id,value:t.id},_(t.name)+" - "+_(t.phoneNumber),9,ye))),128))],512),[[Q,b.value]])]),e("div",be,[s[11]||(s[11]=e("label",{for:"phoneInput",class:"form-label"},"Phone Number",-1)),e("div",ge,[s[10]||(s[10]=e("span",{class:"input-group-text"},"+",-1)),R(e("input",{id:"phoneInput","onUpdate:modelValue":s[1]||(s[1]=t=>w.value=t),type:"tel",class:"form-control",placeholder:"1234567890",required:"",pattern:"[0-9]+",title:"Please enter numbers only"},null,512),[[X,w.value]]),e("button",{type:"submit",class:"modern-btn btn-primary",disabled:v(F)||!b.value||!w.value},[d(l,{icon:v(F)?["fas","spinner"]:["fas","search"],spin:v(F),class:"me-2"},null,8,["icon","spin"]),s[9]||(s[9]=f(" Search "))],8,Ce)]),s[12]||(s[12]=e("div",{class:"form-text"}," Enter phone number including country code (without +) ",-1))])],32)]),v(E).length?(c(),r("div",ke,[e("h5",we,[d(l,{icon:["fas","history"],class:"me-2"}),s[13]||(s[13]=f(" Recent Searches "))]),e("div",Se,[(c(!0),r(H,null,T(v(E),t=>(c(),r("div",{key:t,class:"recent-search-item",onClick:j=>w.value=t},[e("span",Pe,"+"+_(t),1),e("button",{onClick:M(j=>O(t),["stop"]),class:"btn btn-sm btn-outline-danger"},[d(l,{icon:["fas","times"]})],8,Fe)],8,xe))),128))])])):S("",!0)])])]),v(D)?(c(),r("div",Ie,[d(l,{icon:["fas","exclamation-triangle"],class:"me-2"}),f(" "+_(v(D))+" ",1),e("button",{type:"button",class:"btn-close",onClick:s[2]||(s[2]=t=>D.value=null)})])):S("",!0),v(P).length?(c(),r("div",Ae,[e("h4",De,[d(l,{icon:["fas","users"],class:"me-2"}),f(" Contact Results ("+_(v(P).length)+") ",1)]),e("div",Ne,[(c(!0),r(H,null,T(v(P),t=>(c(),r("div",{key:t.jid,class:"col-lg-6 col-xl-4 mb-4"},[e("div",je,[e("div",Ee,[e("div",Oe,[e("div",Ue,[t.profilePicture?(c(),r("img",{key:0,src:t.profilePicture,alt:t.name||t.phoneNumber,class:"avatar-img",onError:i},null,40,He)):(c(),Z(l,{key:1,icon:["fas","user-circle"],class:"avatar-placeholder"}))]),e("button",{onClick:j=>C(t),class:"btn btn-sm btn-outline-primary load-photo-btn",disabled:v(F),title:"Load Profile Picture"},[d(l,{icon:["fas","camera"]})],8,Te)]),e("div",Ve,[e("h6",We,_(t.name||"Unknown"),1),e("p",$e,"+"+_(t.phoneNumber),1),e("div",Je,[t.exists!==void 0?(c(),r("span",{key:0,class:V(["status-badge",t.exists?"status-success":"status-danger"])},[d(l,{icon:t.exists?["fas","check-circle"]:["fas","times-circle"],class:"me-1"},null,8,["icon"]),f(" "+_(t.exists?"Exists":"Not Found"),1)],2)):S("",!0),t.isWhatsAppUser!==void 0?(c(),r("span",{key:1,class:V(["status-badge",t.isWhatsAppUser?"status-success":"status-warning"])},[d(l,{icon:["fab","whatsapp"],class:"me-1"}),f(" "+_(t.isWhatsAppUser?"WhatsApp User":"Not on WhatsApp"),1)],2)):S("",!0),t.isOnline!==void 0?(c(),r("span",{key:2,class:V(["status-badge",t.isOnline?"status-success":"status-secondary"])},[d(l,{icon:t.isOnline?["fas","circle"]:["far","circle"],class:"me-1"},null,8,["icon"]),f(" "+_(t.isOnline?"Online":"Offline"),1)],2)):S("",!0)]),t.status?(c(),r("div",Be,[e("small",Me,[d(l,{icon:["fas","quote-left"],class:"me-1"}),f(" "+_(t.status),1)])])):S("",!0),t.lastSeen?(c(),r("div",Re,[e("small",qe,[d(l,{icon:["fas","clock"],class:"me-1"}),f(" Last seen: "+_(k(t.lastSeen)),1)])])):S("",!0),e("div",Le,[e("button",{onClick:j=>g(t),class:"btn btn-sm btn-outline-info me-2",disabled:v(F),title:"Refresh Status"},[d(l,{icon:["fas","sync"]})],8,ze),e("button",{onClick:j=>a(t.jid),class:"btn btn-sm btn-outline-secondary",title:"Copy JID"},[d(l,{icon:["fas","copy"]})],8,Ge)])])])])]))),128))])])):v(F)?S("",!0):(c(),r("div",Ke,[e("div",Qe,[d(l,{icon:["fas","search"],class:"empty-icon"}),s[14]||(s[14]=e("h4",null,"No Contacts Found",-1)),s[15]||(s[15]=e("p",{class:"text-muted"},"Search for a phone number to get started",-1))])]))])])])}}}),Ze=ee(Xe,[["__scopeId","data-v-1132bcf9"]]);export{Ze as default};
