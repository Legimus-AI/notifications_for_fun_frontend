import{d as G,x as K,r as p,y as I,H as V,o as X,c as l,b as o,a as e,P as Y,g as d,e as Z,t as i,f as v,F as S,A as D,B as k,n as ee,E as se,m as c,_ as te}from"./index-C3Rphj7m.js";const ae={class:"whatsapp-messages-container"},ne={class:"main-content"},oe={class:"content-grid"},ie={class:"channels-sidebar"},le={class:"sidebar-header"},ce={class:"sidebar-title"},de={class:"channels-count"},re={class:"channels-list"},ue=["onClick"],pe={class:"channel-info"},he={class:"channel-header"},_e={class:"channel-name"},ve={class:"channel-meta"},ge={class:"channel-id"},me={key:0,class:"channel-phone"},fe={key:0,class:"loading-state"},ye={class:"loading-spinner"},be={key:1,class:"empty-state"},ke={class:"events-content"},we={key:0,class:"events-section"},Ce={class:"events-header"},Me={class:"events-title-section"},xe={class:"events-title"},Se={class:"events-stats"},Pe={class:"stat-item"},Ae={key:0,class:"stat-item"},Ne=["disabled"],Te={class:"events-table-container"},Ie={key:0,class:"loading-overlay"},Ve={class:"loading-spinner"},De={key:1,class:"events-table-wrapper"},Ee={class:"events-table"},Le={class:"event-row"},We={class:"time-cell"},$e={class:"time-info"},Fe={class:"time-primary"},Be={class:"time-secondary"},Re={class:"sender-cell"},Ue={class:"sender-info"},qe={class:"sender-avatar"},He={class:"sender-details"},Je={class:"sender-name"},Oe={class:"sender-phone"},je={class:"type-cell"},ze={class:"message-cell"},Qe={class:"message-content"},Ge={class:"message-text"},Ke={class:"actions-cell"},Xe=["onClick","title"],Ye={key:0,class:"payload-row"},Ze={colspan:"5",class:"payload-cell"},es={class:"payload-container"},ss={class:"payload-header"},ts={class:"payload-title"},as={class:"payload-actions"},ns=["onClick"],os=["onClick"],is={class:"payload-content"},ls={class:"payload-json"},cs={key:2,class:"empty-events"},ds={key:0,class:"pagination-nav"},rs={class:"pagination-info"},us={class:"pagination-total"},ps={class:"pagination-controls"},hs=["disabled"],_s=["disabled"],vs={key:1,class:"no-selection"},gs={class:"no-selection-content"},ms=30,fs=G({__name:"WhatsAppMessagesView",setup(ys){const P=K(),{error:w,success:A}=ee(),f=p([]),u=p(null),g=p(!1),y=p(!1),r=p(1),m=p(1),b=p(0),h=p(new Set),_=I(()=>P.channels),N=I(()=>_.value.find(t=>t.channelId===u.value)),E=t=>{u.value=t,r.value=1},L=t=>new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),W=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}),$=t=>t.pushName||"Unknown",F=t=>{var n;const s=(n=t.key)==null?void 0:n.remoteJid;return s?s.split("@")[0]:""},C=t=>{if(!t.message)return"Unknown";const s=t.message;return s.conversation||s.extendedTextMessage?"Text":s.stickerMessage?"Sticker":s.imageMessage?"Image":s.videoMessage?"Video":s.audioMessage?"Audio":s.documentMessage?"Document":"Other"},B=t=>{switch(C(t)){case"Text":return["fas","comment"];case"Sticker":return["fas","smile"];case"Image":return["fas","image"];case"Video":return["fas","video"];case"Audio":return["fas","microphone"];case"Document":return["fas","file"];default:return["fas","question-circle"]}},R=t=>{if(!t.message)return"No message content";const s=t.message;return s.conversation?s.conversation:s.extendedTextMessage?s.extendedTextMessage.text:s.stickerMessage?"ðŸŽ­ Sticker message":s.imageMessage?"ðŸ“¸ Image message":s.videoMessage?"ðŸŽ¥ Video message":s.audioMessage?"ðŸŽµ Audio message":s.documentMessage?"ðŸ“„ Document message":"Media message"},U=t=>{switch(t){case"active":case"open":return"active";case"connecting":return"connecting";case"qr_ready":case"pairing_code_ready":return"ready";default:return"inactive"}},q=t=>{switch(t){case"active":case"open":return"Active";case"connecting":return"Connecting";case"qr_ready":return"QR Ready";case"pairing_code_ready":return"Pairing Ready";default:return"Inactive"}},M=async()=>{if(u.value){g.value=!0;try{const t={channelId:u.value,sort:"updatedAt",order:"desc",page:r.value,limit:ms},s=await se.getWhatsAppEvents(t);s.ok&&s.payload&&(f.value=s.payload,b.value=s.totalDocs,m.value=s.totalPages)}catch(t){w(t.message||"Failed to fetch events")}finally{g.value=!1}}},H=async()=>{await M(),A("Events refreshed successfully")},J=()=>{r.value<m.value&&r.value++},O=()=>{r.value>1&&r.value--},j=async()=>{y.value=!0;try{await P.fetchChannels(),_.value.length>0&&(u.value=_.value[0].channelId)}catch(t){w(t.message||"Failed to load channels")}finally{y.value=!1}},T=t=>{h.value.has(t)?h.value.delete(t):h.value.add(t)},z=t=>JSON.stringify(t,null,2),Q=async t=>{try{await navigator.clipboard.writeText(JSON.stringify(t,null,2)),A("Payload copied to clipboard")}catch{w("Failed to copy payload")}};return V(u,()=>{r.value=1,M()}),V(r,M),X(()=>{j()}),(t,s)=>{const n=Z("font-awesome-icon");return c(),l("div",ae,[o(Y,{title:"Messages",subtitle:"View events from your WhatsApp channels",icon:["fas","comments"],breadcrumbs:[{label:"WhatsApp",icon:["fab","whatsapp"],to:"/"},{label:"Messages",icon:["fas","comments"]}]}),e("main",ne,[e("div",oe,[e("aside",ie,[e("div",le,[e("h3",ce,[o(n,{icon:["fab","whatsapp"],class:"sidebar-icon"}),s[0]||(s[0]=d(" Channels "))]),e("span",de,i(_.value.length),1)]),e("div",re,[(c(!0),l(S,null,D(_.value,a=>(c(),l("div",{key:a.channelId,class:k(["channel-card",{"channel-card--selected":u.value===a.channelId}]),onClick:x=>E(a.channelId)},[e("div",pe,[e("div",he,[e("h4",_e,i(a.name),1),e("span",{class:k(["status-badge",`status-badge--${U(a.status)}`])},[s[1]||(s[1]=e("i",{class:"status-dot"},null,-1)),d(" "+i(q(a.status)),1)],2)]),e("div",ve,[e("span",ge,i(a.channelId.slice(0,8))+"...",1),a.phoneNumber?(c(),l("span",me,[o(n,{icon:["fas","phone"]}),d(" "+i(a.phoneNumber),1)])):v("",!0)])])],10,ue))),128)),y.value?(c(),l("div",fe,[e("div",ye,[o(n,{icon:["fas","spinner"],spin:""})]),s[2]||(s[2]=e("p",null,"Loading channels...",-1))])):v("",!0),!y.value&&_.value.length===0?(c(),l("div",be,[o(n,{icon:["fab","whatsapp"],class:"empty-icon"}),s[3]||(s[3]=e("p",null,"No channels available",-1))])):v("",!0)])]),e("section",ke,[u.value&&N.value?(c(),l("div",we,[e("div",Ce,[e("div",Me,[e("h2",xe,[o(n,{icon:["fas","comments"],class:"events-icon"}),d(" Events for "+i(N.value.name),1)]),e("div",Se,[e("span",Pe,[o(n,{icon:["fas","clock"]}),d(" "+i(f.value.length)+" events ",1)]),b.value>0?(c(),l("span",Ae,[o(n,{icon:["fas","circle"]}),d(" "+i(b.value)+" total ",1)])):v("",!0)])]),e("button",{class:"refresh-btn",onClick:H,disabled:g.value},[o(n,{icon:["fas","sync"],spin:g.value},null,8,["spin"]),s[4]||(s[4]=d(" Refresh "))],8,Ne)]),e("div",Te,[g.value?(c(),l("div",Ie,[e("div",Ve,[o(n,{icon:["fas","spinner"],spin:""})]),s[5]||(s[5]=e("p",null,"Loading events...",-1))])):f.value.length>0?(c(),l("div",De,[e("table",Ee,[s[8]||(s[8]=e("thead",null,[e("tr",null,[e("th",null,"Time"),e("th",null,"Sender"),e("th",null,"Type"),e("th",null,"Message"),e("th",null,"Actions")])],-1)),e("tbody",null,[(c(!0),l(S,null,D(f.value,a=>(c(),l(S,{key:a._id},[e("tr",Le,[e("td",We,[e("div",$e,[e("span",Fe,i(L(a.createdAt)),1),e("span",Be,i(W(a.createdAt)),1)])]),e("td",Re,[e("div",Ue,[e("div",qe,[o(n,{icon:["fas","user-circle"]})]),e("div",He,[e("span",Je,i($(a.payload)),1),e("span",Oe,i(F(a.payload)),1)])])]),e("td",je,[e("span",{class:k(["message-type-badge",`type-${C(a.payload).toLowerCase()}`])},[o(n,{icon:B(a.payload)},null,8,["icon"]),d(" "+i(C(a.payload)),1)],2)]),e("td",ze,[e("div",Qe,[e("p",Ge,i(R(a.payload)),1)])]),e("td",Ke,[e("button",{class:k(["payload-toggle-btn",{active:h.value.has(a._id)}]),onClick:x=>T(a._id),title:h.value.has(a._id)?"Hide payload":"Show payload"},[o(n,{icon:["fas",h.value.has(a._id)?"chevron-up":"chevron-down"]},null,8,["icon"])],10,Xe)])]),h.value.has(a._id)?(c(),l("tr",Ye,[e("td",Ze,[e("div",es,[e("div",ss,[e("h4",ts,[o(n,{icon:["fas","code"]}),s[6]||(s[6]=d(" Complete Payload "))]),e("div",as,[e("button",{class:"copy-btn",onClick:x=>Q(a.payload),title:"Copy payload to clipboard"},[o(n,{icon:["fas","copy"]}),s[7]||(s[7]=d(" Copy "))],8,ns),e("button",{class:"close-payload-btn",onClick:x=>T(a._id),title:"Close payload"},[o(n,{icon:["fas","times"]})],8,os)])]),e("div",is,[e("pre",ls,i(z(a.payload)),1)])])])])):v("",!0)],64))),128))])])])):(c(),l("div",cs,[o(n,{icon:["fas","comments"],class:"empty-icon"}),s[9]||(s[9]=e("h3",null,"No events found",-1)),s[10]||(s[10]=e("p",null,"This channel hasn't received any messages yet.",-1))]))]),m.value>1?(c(),l("nav",ds,[e("div",rs,[e("span",null,"Page "+i(r.value)+" of "+i(m.value),1),e("span",us,i(b.value)+" total events",1)]),e("div",ps,[e("button",{class:"pagination-btn pagination-btn--prev",onClick:O,disabled:r.value===1},[o(n,{icon:["fas","chevron-left"]}),s[11]||(s[11]=d(" Previous "))],8,hs),e("button",{class:"pagination-btn pagination-btn--next",onClick:J,disabled:r.value>=m.value},[s[12]||(s[12]=d(" Next ")),o(n,{icon:["fas","chevron-right"]})],8,_s)])])):v("",!0)])):(c(),l("div",vs,[e("div",gs,[o(n,{icon:["fab","whatsapp"],class:"no-selection-icon"}),s[13]||(s[13]=e("h3",null,"Select a Channel",-1)),s[14]||(s[14]=e("p",null," Choose a WhatsApp channel from the sidebar to view its message events. ",-1))])]))])])])])}}}),ks=te(fs,[["__scopeId","data-v-cbd80a5f"]]);export{ks as default};
