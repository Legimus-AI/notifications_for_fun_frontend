import{d as Z,x as ee,s as se,r as _,y as V,o as te,c as l,b as v,a as e,q as W,S as U,P as ae,i as b,z as oe,t as u,g as c,e as le,F as A,A as x,B as m,f as ne,w as ie,T as re,C as ce,n as de,m as n,_ as ue}from"./index-C-TZf3mn.js";import{v as ve,e as E,z as be}from"./bootstrap-vue-3.es-DWx-ywBm.js";const me={class:"webhooks-container"},he={class:"content-wrapper"},pe={key:0,class:"state-container"},ge={key:1,class:"state-container"},fe={class:"state-card error"},ke={class:"state-text"},_e={key:2,class:"state-container"},we={class:"state-card empty"},ye={key:3,class:"channels-grid"},Ce={class:"card-header"},We={class:"channel-info"},Ae={class:"channel-title"},xe={class:"channel-name"},Fe={class:"channel-meta"},Ve={key:0,class:"meta-item"},Te={class:"meta-item"},Se={class:"channel-actions"},Ne=["onClick"],De={class:"webhook-form"},Me=["onSubmit"],Ue={class:"form-group"},Ee={class:"input-group"},Ie={class:"form-group"},Pe={class:"events-grid"},ze={class:"event-content"},$e={class:"event-label"},Le={class:"form-actions"},Be=["onClick"],Re=["disabled"],qe={key:0,class:"btn-spinner"},je={key:1,class:"bi bi-plus-circle me-2"},He={class:"webhooks-section"},Ge={class:"section-header"},Je={class:"webhook-count"},Ke={key:0,class:"empty-webhooks"},Oe={key:1,class:"webhooks-list"},Qe={class:"webhook-status"},Xe={class:"webhook-content"},Ye={class:"webhook-url"},Ze={class:"url-text"},es={class:"webhook-events"},ss={class:"webhook-controls"},ts={class:"toggle-wrapper"},as=["onClick"],os=Z({__name:"WebhooksView",setup(ls){const h=ee(),{success:F,error:p}=de(),{channels:I,isLoading:w,error:T}=se(h),g=_({}),r=_({}),y=_(!1),f=_({title:"",message:"",variant:"danger",confirmText:"Delete"}),k=_(null),P=[{value:"message.received",label:"Message Received"},{value:"message.sent",label:"Message Sent"},{value:"message.delivered",label:"Message Delivered"},{value:"message.read",label:"Message Read"}],C=V(()=>I.value.filter(t=>t.status==="active"||t.status==="open")),z=V(()=>C.value.length),$=V(()=>C.value.reduce((t,s)=>{var d;return t+(((d=s.webhooks)==null?void 0:d.length)||0)},0)),S=async()=>{try{await h.fetchChannels()}catch{p("Failed to load channels. Please try again.")}},L=t=>{g.value[t]=!0,r.value[t]||(r.value[t]={url:"",events:["message.received"]})},B=(t,s)=>{r.value[t]||(r.value[t]={url:"",events:["message.received"]}),r.value[t].url=s},R=(t,s)=>{r.value[t]||(r.value[t]={url:"",events:["message.received"]}),r.value[t].events=s},N=t=>{g.value[t]=!1,r.value[t]={url:"",events:["message.received"]}},q=async t=>{const s=r.value[t];if(!s||!s.url||s.events.length===0){p("Please fill in all required fields and select at least one event.");return}try{await h.addWebhookToChannel(t,{url:s.url,events:s.events}),F("Webhook added successfully!"),N(t)}catch(d){console.error("Failed to add webhook:",d),p("Failed to add webhook. Please try again.")}},j=async(t,s,d)=>{if(s)try{await h.toggleChannelWebhook(t,s,d),F(`Webhook ${d?"activated":"deactivated"} successfully!`)}catch(a){console.error("Failed to toggle webhook:",a),p("Failed to update webhook status. Please try again.")}},H=(t,s)=>{s&&(f.value={title:"Delete Webhook",message:"Are you sure you want to delete this webhook? This action cannot be undone.",variant:"danger",confirmText:"Delete Webhook"},k.value=async()=>{await G(t,s)},y.value=!0)},G=async(t,s)=>{try{await h.deleteChannelWebhook(t,s),F("Webhook deleted successfully!")}catch(d){console.error("Failed to delete webhook:",d),p("Failed to delete webhook. Please try again.")}},J=async()=>{if(k.value)try{await k.value()}catch(t){console.error("Action failed:",t)}y.value=!1,k.value=null},K=()=>{y.value=!1,k.value=null},O=t=>{switch(t){case"active":case"open":return"success";case"connecting":return"warning";case"error":return"danger";default:return"secondary"}},Q=t=>{switch(t){case"active":case"open":return"Active";case"connecting":return"Connecting";case"error":return"Error";default:return"Inactive"}},D=t=>{switch(t){case"message.received":return"bi bi-arrow-down-circle";case"message.sent":return"bi bi-arrow-up-circle";case"message.delivered":return"bi bi-check-circle";case"message.read":return"bi bi-check2-all";default:return"bi bi-circle"}},X=t=>t.split(".").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ");return te(S),(t,s)=>{const d=le("router-link");return n(),l("div",me,[v(ae,{title:"Webhooks",subtitle:"Configure and monitor webhook endpoints for real-time notifications",icon:["fas","share-nodes"],breadcrumbs:[{label:"Integrations",icon:["fas","puzzle-piece"],to:"/"},{label:"Webhooks",icon:["fas","share-nodes"]}]},{stats:W(()=>[v(U,{value:z.value,label:"Active Channels","bootstrap-icon":"bi bi-broadcast"},null,8,["value"]),v(U,{value:$.value,label:"Total Webhooks","bootstrap-icon":"bi bi-link-45deg"},null,8,["value"])]),_:1}),e("div",he,[b(w)?(n(),l("div",pe,s[0]||(s[0]=[oe('<div class="state-card loading" data-v-196f9d1f><div class="state-icon" data-v-196f9d1f><div class="loading-spinner" data-v-196f9d1f><div class="spinner" data-v-196f9d1f></div></div></div><h3 class="state-title" data-v-196f9d1f>Loading Channels</h3><p class="state-text" data-v-196f9d1f>Please wait while we fetch your channels...</p></div>',1)]))):b(T)?(n(),l("div",ge,[e("div",fe,[s[2]||(s[2]=e("div",{class:"state-icon"},[e("i",{class:"bi bi-exclamation-triangle"})],-1)),s[3]||(s[3]=e("h3",{class:"state-title"},"Something went wrong",-1)),e("p",ke,u(b(T)),1),e("button",{class:"modern-btn primary",onClick:S},s[1]||(s[1]=[e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),c("Try Again ")]))])])):C.value.length===0?(n(),l("div",_e,[e("div",we,[s[5]||(s[5]=e("div",{class:"state-icon"},[e("i",{class:"bi bi-chat-dots"})],-1)),s[6]||(s[6]=e("h3",{class:"state-title"},"No Active Channels",-1)),s[7]||(s[7]=e("p",{class:"state-text"}," Create and activate WhatsApp channels to start configuring webhooks ",-1)),v(d,{to:"/",class:"modern-btn success"},{default:W(()=>s[4]||(s[4]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),c("Create First Channel ")])),_:1,__:[4]})])])):(n(),l("div",ye,[(n(!0),l(A,null,x(C.value,a=>(n(),l("div",{key:a.channelId,class:"modern-card channel-card"},[e("div",Ce,[s[12]||(s[12]=e("div",{class:"channel-avatar"},[e("i",{class:"bi bi-whatsapp"})],-1)),e("div",We,[e("div",Ae,[e("h3",xe,u(a.name),1),e("span",{class:m(["status-badge",O(a.status)])},[s[8]||(s[8]=e("i",{class:"status-dot"},null,-1)),c(" "+u(Q(a.status)),1)],2)]),e("div",Fe,[a.phoneNumber?(n(),l("span",Ve,[s[9]||(s[9]=e("i",{class:"bi bi-telephone me-1"},null,-1)),c(u(a.phoneNumber),1)])):ne("",!0),e("span",Te,[s[10]||(s[10]=e("i",{class:"bi bi-tag me-1"},null,-1)),c(u(a.channelId.slice(0,8))+"... ",1)])])]),e("div",Se,[e("button",{class:m(["modern-btn primary sm",{active:g.value[a.channelId]}]),onClick:o=>L(a.channelId)},s[11]||(s[11]=[e("i",{class:"bi bi-plus-lg"},null,-1),e("span",null,"Add Webhook",-1)]),10,Ne)])]),v(b(be),{modelValue:g.value[a.channelId],"onUpdate:modelValue":o=>g.value[a.channelId]=o,class:"webhook-form-collapse"},{default:W(()=>{var o;return[e("div",De,[s[18]||(s[18]=e("div",{class:"form-header"},[e("h4",{class:"form-title"},[e("i",{class:"bi bi-plus-circle me-2"}),c(" Configure New Webhook ")]),e("p",{class:"form-subtitle"}," Add a webhook endpoint to receive real-time notifications ")],-1)),e("form",{onSubmit:ie(i=>q(a.channelId),["prevent"]),class:"modern-form"},[e("div",Ue,[s[14]||(s[14]=e("label",{class:"form-label"},[e("i",{class:"bi bi-link me-2"}),c("Webhook URL ")],-1)),e("div",Ee,[s[13]||(s[13]=e("div",{class:"input-icon"},[e("i",{class:"bi bi-globe"})],-1)),v(b(ve),{"model-value":((o=r.value[a.channelId])==null?void 0:o.url)||"","onUpdate:modelValue":i=>B(a.channelId,i),type:"url",placeholder:"https://your-server.com/webhook",required:"",class:"modern-input"},null,8,["model-value","onUpdate:modelValue"])])]),e("div",Ie,[s[15]||(s[15]=e("label",{class:"form-label"},[e("i",{class:"bi bi-lightning me-2"}),c("Event Types ")],-1)),e("div",Pe,[(n(),l(A,null,x(P,i=>{var M;return e("div",{key:i.value,class:"event-option"},[v(b(E),{"model-value":((M=r.value[a.channelId])==null?void 0:M.events)||[],"onUpdate:modelValue":Y=>R(a.channelId,Y),value:i.value,class:"event-checkbox"},{default:W(()=>[e("div",ze,[e("i",{class:m(["event-icon",D(i.value)])},null,2),e("span",$e,u(i.label),1)])]),_:2},1032,["model-value","onUpdate:modelValue","value"])])}),64))])]),e("div",Le,[e("button",{type:"button",class:"modern-btn secondary",onClick:i=>N(a.channelId)},s[16]||(s[16]=[e("i",{class:"bi bi-x me-2"},null,-1),c("Cancel ")]),8,Be),e("button",{type:"submit",class:"modern-btn primary",disabled:b(w)},[b(w)?(n(),l("span",qe,s[17]||(s[17]=[e("i",{class:"bi bi-arrow-repeat spinning me-2"},null,-1)]))):(n(),l("i",je)),c(" "+u(b(w)?"Adding...":"Add Webhook"),1)],8,Re)])],40,Me)])]}),_:2},1032,["modelValue","onUpdate:modelValue"]),e("div",He,[e("div",Ge,[s[19]||(s[19]=e("h4",{class:"section-title"},[e("i",{class:"bi bi-list-check me-2"}),c(" Configured Webhooks ")],-1)),e("div",Je,u((a.webhooks||[]).length),1)]),!a.webhooks||a.webhooks.length===0?(n(),l("div",Ke,s[20]||(s[20]=[e("div",{class:"empty-icon"},[e("i",{class:"bi bi-link-45deg"})],-1),e("p",{class:"empty-text"},"No webhooks configured yet",-1)]))):(n(),l("div",Oe,[(n(!0),l(A,null,x(a.webhooks,o=>(n(),l("div",{key:o._id,class:m(["webhook-item",{inactive:!o.isActive}])},[e("div",Qe,[e("div",{class:m(["status-indicator",{active:o.isActive}])},null,2)]),e("div",Xe,[e("div",Ye,[s[21]||(s[21]=e("i",{class:"bi bi-link-45deg me-2"},null,-1)),e("span",Ze,u(o.url),1),e("div",{class:m(["webhook-badge",{active:o.isActive}])},u(o.isActive?"Active":"Inactive"),3)]),e("div",es,[(n(!0),l(A,null,x(o.events,i=>(n(),l("span",{key:i,class:"event-badge"},[e("i",{class:m(["event-badge-icon",D(i)])},null,2),c(" "+u(X(i)),1)]))),128))])]),e("div",ss,[e("div",ts,[v(b(E),{switch:"",checked:o.isActive,onChange:i=>o._id&&j(a.channelId,o._id,!o.isActive),class:"modern-toggle"},null,8,["checked","onChange"])]),e("button",{class:"action-btn danger",onClick:i=>o._id&&H(a.channelId,o._id),title:"Delete Webhook"},s[22]||(s[22]=[e("i",{class:"bi bi-trash3"},null,-1)]),8,as)])],2))),128))]))])]))),128))]))]),v(re),v(ce,{show:y.value,title:f.value.title,message:f.value.message,variant:f.value.variant,"confirm-text":f.value.confirmText,onConfirm:J,onCancel:K},null,8,["show","title","message","variant","confirm-text"])])}}}),rs=ue(os,[["__scopeId","data-v-196f9d1f"]]);export{rs as default};
